<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LD58 Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 1280px;
            height: 100vh;
            background: #000;
            overflow: hidden;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }
        
        #ui > * {
            pointer-events: auto;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            text-align: center;
        }
        
        #debug {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            display: none;
            max-width: 400px;
        }
        
        #ui-panel {
            position: absolute;
            bottom: -433px; /* Start hidden below screen */
            left: 0;
            width: 100%;
            height: 433px;
            background-image: url('assets/textures/ui_bkgd.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: bottom 0.8s ease-out;
            z-index: 50;
        }
        
        #ui-panel.visible {
            bottom: 0; /* Slide up to visible position */
        }
        
        #black-hud {
            position: absolute;
            bottom: 40px;
            right: 5px;
            opacity: 0;
            transition: opacity 0 ease-in;
            z-index: 60;
            width: 155px;
            rotate: -50deg;
            clip-path: polygon(0 0, 100% 0, 100% 50%, 63% 100%, 37% 100%, 0% 50%);
        }
        
        #black-hud.visible {
            opacity: 1;
        }
        
        #distance-display {
            position: absolute;
            bottom: 220px;
            right: 35px;
            opacity: 0;
            transition: opacity 0.5s ease-in;
            z-index: 60;
            font-family: 'Courier New', monospace;
            color: rgba(0, 255, 255, 1);
            text-align: right;
        }
        
        #distance-display.visible {
            opacity: 1;
        }
        
        #distance-value {
            font-size: 32px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
        }
        
        #distance-label {
            font-size: 10px;
            color: rgba(150, 150, 150, 1);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #hud-bars {
            position: absolute;
            bottom: 30px;
            left: 40px;
            display: none;
            gap: 20px;
            z-index: 60;
        }
        
        #hud-bars.visible {
            display: flex;
        }
        
        .bar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        
        .bar-wrapper {
            width: 30px;
            height: 150px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(0, 255, 255, 0.5);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .bar-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(to top, rgba(0, 255, 255, 0.8), rgba(0, 255, 255, 0.3));
            transition: height 0.3s ease;
        }
        
        .bar-value {
            color: rgba(0, 255, 255, 1);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            min-width: 50px;
        }
        
        .bar-label {
            color: rgba(150, 150, 150, 1);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            text-align: center;
            text-transform: uppercase;
        }
        
        
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
        }

        /* Menu Styles */
        #menu {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: auto;
            height: auto;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #menu.hidden {
            display: none;
        }

        .menu-title {
            color: white;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .menu-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            min-width: 180px;
        }

        .menu-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .menu-button:active {
            transform: translateY(0);
        }

        /* Modal Styles */
        #controls-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        #controls-modal.show {
            display: flex;
        }
        
        /* Game Over Modal */
        #game-over-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }
        
        #game-over-modal.show {
            display: flex;
        }
        
        .game-over-content {
            background: linear-gradient(135deg, #1a1a1a 0%, #2c2c2c 100%);
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            border: 3px solid #ff0000;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            max-width: 500px;
        }
        
        .game-over-title {
            font-size: 48px;
            color: #ff0000;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 0, 0, 0.8);
            font-weight: bold;
        }
        
        .game-over-message {
            font-size: 20px;
            color: #ffffff;
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        /* Station Modal */
        #station-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            cursor: default !important;
        }
        
        #station-modal.show {
            display: flex;
        }
        
        #station-modal * {
            cursor: default !important;
        }
        
        #station-modal button {
            cursor: pointer !important;
        }
        
        .station-content {
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #00ffff;
            box-shadow: 0 0 40px rgba(0, 255, 255, 0.4);
            max-width: 1000px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            cursor: default !important;
        }
        
        .station-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .station-title {
            font-size: 36px;
            color: #00ffff;
            text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
            margin-bottom: 10px;
        }
        
        .station-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 20px;
        }
        
        .station-stat {
            text-align: center;
        }
        
        .station-stat-label {
            font-size: 14px;
            color: #888;
            text-transform: uppercase;
        }
        
        .station-stat-value {
            font-size: 28px;
            color: #00ff00;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.6);
        }
        
        .station-body {
            display: flex;
            gap: 30px;
            margin-top: 30px;
        }
        
        .station-ship-display {
            flex: 0 0 300px;
            height: 300px;
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ffff;
            border-radius: 10px;
            position: relative;
            cursor: default !important;
        }
        
        .station-left-panel {
            flex: 0 0 300px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .station-upgrades {
            flex: 1;
            overflow-y: auto;
            max-height: calc(80vh - 250px);
        }
        
        .station-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #00ffff;
        }
        
        .station-tab {
            padding: 12px 24px;
            background: rgba(0, 255, 255, 0.1);
            border: none;
            color: #00ffff;
            font-size: 16px;
            cursor: pointer;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            transition: all 0.3s;
        }
        
        .station-tab:hover {
            background: rgba(0, 255, 255, 0.2);
        }
        
        .station-tab.active {
            background: rgba(0, 255, 255, 0.3);
            border-bottom: 3px solid #00ffff;
        }
        
        .station-tab-content {
            display: none;
            min-height: 200px;
        }
        
        .station-tab-content.active {
            display: block;
        }
        
        .upgrade-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .upgrade-info h3 {
            color: #00ffff;
            margin: 0 0 5px 0;
            font-size: 18px;
        }
        
        .upgrade-info p {
            color: #ccc;
            margin: 0;
            font-size: 14px;
        }
        
        .upgrade-price {
            font-size: 20px;
            color: #00ff00;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .upgrade-buy-btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upgrade-buy-btn:hover {
            background: #00ff88;
            transform: scale(1.05);
        }
        
        .upgrade-buy-btn:disabled {
            background: #555;
            color: #888;
            cursor: not-allowed;
            transform: none;
        }
        
        .station-return-btn {
            background: #ff8800;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer !important;
            width: 100%;
            transition: all 0.3s;
        }
        
        .station-return-btn:hover {
            background: #ffa500;
            transform: scale(1.05);
        }
        
        /* Mineral Markets Table */
        .mineral-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .mineral-table th {
            background: rgba(0, 255, 255, 0.2);
            color: #00ffff;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #00ffff;
            font-size: 14px;
            text-transform: uppercase;
        }
        
        .mineral-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.2);
            color: #ccc;
        }
        
        .mineral-table tr:hover {
            background: rgba(0, 255, 255, 0.1);
        }
        
        .mineral-name {
            color: #fff;
            font-weight: bold;
            font-size: 15px;
        }
        
        .mineral-rarity {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            display: inline-block;
        }
        
        .rarity-common {
            background: rgba(128, 128, 128, 0.3);
            color: #aaa;
        }
        
        .rarity-uncommon {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .rarity-rare {
            background: rgba(0, 150, 255, 0.2);
            color: #0096ff;
        }
        
        .rarity-epic {
            background: rgba(160, 32, 240, 0.2);
            color: #a020f0;
        }
        
        .rarity-legendary {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
        }
        
        .mineral-value {
            color: #00ff00;
            font-weight: bold;
            font-size: 16px;
        }
        
        .mineral-bonus {
            font-size: 13px;
            font-style: italic;
            color: #aaa;
        }
        
        /* Tutorial Messages */
        #tutorial-message {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 10px;
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            display: none;
            max-width: 80%;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        #tutorial-message.warning {
            color: #ffff00;
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.8);
            border: 2px solid #ffff00;
        }
        
        #tutorial-message.danger {
            color: #ff0000;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
            border: 2px solid #ff0000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Red danger overlay */
        #danger-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 0, 0, 0) 0%, rgba(255, 0, 0, 0.5) 100%);
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
        }

        .modal-header {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .volume-control {
            margin-bottom: 20px;
        }

        .volume-label {
            color: white;
            font-size: 16px;
            margin-bottom: 10px;
            display: block;
        }

        .volume-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ff6b6b;
            cursor: pointer;
            border: none;
        }

        .volume-value {
            color: #ff6b6b;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Title Styles */
        #title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
            pointer-events: none;
        }

        #title img {
            max-width: 400px;
            height: auto;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.5));
        }

        /* Scrolling Text Styles */
        #scrolling-text {
            position: absolute;
            background: rgba(0, 0, 0, 0.5);
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            perspective: 400px;
            overflow: hidden;
            z-index: 999;
            pointer-events: none;
            padding: 20px;
            border-radius: 15px;
        }

        .crawl {
            position: absolute;
            background: rgba(0, 0, 0, 0.5);
            top: 100%;
            left: 50%;
            width: 80%;
            max-width: 600px;
            transform: translateX(-50%) rotateX(15deg);
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            line-height: 1.6;
            color: #ffd700;
            text-align: justify;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: crawl 80s linear infinite;
            padding: 20px;
            border-radius: 15px;
        }

        @keyframes crawl {
            0% {
                top: 100%;
                opacity: 1;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                top: -200%;
                opacity: 0;
            }
        }

        .crawl h2 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 30px;
            color: #ff6b00;
            text-shadow: 0 0 15px rgba(255, 107, 0, 0.8);
        }
    </style>
</head>
<body>
    <!-- Scrolling Text -->
    <div id="scrolling-text">
        <div class="crawl">
            <p>You're about to drop out of hyperspace at the deadliest address in the universe: the edge of a black hole.</p>
            <p>Suicidal? Maybe. Profitable? Definitely.</p>
            <p>Why chase rare minerals across the galaxy when gravity drags every treasure here?</p>
            <p>Your ship is armed with FTL drives, a stasis field, a laser built to crack asteroids, and an iron extractor. The mission is simple: dive in, snatch as much as you can, and escape before the horizon swallows you.</p>
            <p>Fuel runs thin. Every scrap you haul makes your ship heavier. Debris storms shove you closer to oblivion.</p>
            <p>The universe isn't on your side. Collect or be consumed.</p>
        </div>
    </div>

    <!-- Title -->
    <div id="title">
        <img src="assets/textures/title.png" alt="Black Hole Salvage">
    </div>

    <!-- Main Menu -->
    <div id="menu">
        <div class="menu-buttons">
            <button class="menu-button" id="start-button">Start Game</button>
            <button class="menu-button" id="controls-button">Controls</button>
        </div>
    </div>

    <!-- Controls Modal -->
    <div id="controls-modal">
        <div class="modal-content">
            <button class="modal-close" id="modal-close">&times;</button>
            <h2 class="modal-header">Controls & Settings</h2>
            
            <div class="volume-control">
                <label class="volume-label" for="music-volume">Music Volume</label>
                <input type="range" id="music-volume" class="volume-slider" min="0" max="100" value="50">
                <div class="volume-value" id="music-value">50%</div>
            </div>
            
            <div class="volume-control">
                <label class="volume-label" for="sfx-volume">SFX Volume</label>
                <input type="range" id="sfx-volume" class="volume-slider" min="0" max="100" value="50">
                <div class="volume-value" id="sfx-value">50%</div>
            </div>
            
            <div style="margin-top: 30px; color: white; font-size: 14px; line-height: 1.5;">
                <strong>Controls:</strong><br>
                WASD: Move<br>
                Mouse: Look Around<br>
                Spacebar: Jump away from the black hole<br>
                ESC: Open/Close Menu
            </div>
            
            <div style="margin-top: 20px; text-align: center;">
                <button id="return-to-menu" class="menu-button" style="padding: 10px 20px; font-size: 16px; min-width: auto;">Return to Menu</button>
            </div>
        </div>
    </div>
    
    <!-- Game Over Modal -->
    <div id="game-over-modal">
        <div class="game-over-content">
            <div class="game-over-title">CONSUMED BY THE VOID</div>
            <div class="game-over-message">
                Your ship was pulled into the event horizon and crushed by the immense gravitational forces of the black hole.
            </div>
            <button id="game-over-menu" class="menu-button">Return to Menu</button>
        </div>
    </div>
    
    <!-- Trading Station Modal -->
    <div id="station-modal">
        <div class="station-content">
            <div class="station-header">
                <h1 class="station-title">PROXIMA PROCESSING STATION</h1>
                <div class="station-stats">
                    <div class="station-stat">
                        <div class="station-stat-label">Your Credits</div>
                        <div class="station-stat-value" id="station-credits">0</div>
                    </div>
                    <div class="station-stat">
                        <div class="station-stat-label">Cargo Value</div>
                        <div class="station-stat-value" id="station-cargo-value">0</div>
                    </div>
                    <div class="station-stat">
                        <div class="station-stat-label">Iron Sold</div>
                        <div class="station-stat-value" id="station-iron-sold">0.0t</div>
                    </div>
                </div>
            </div>
            
            <div class="station-body">
                <div class="station-left-panel">
                    <div class="station-ship-display" id="station-ship-viewer">
                        <!-- 3D ship will be rendered here -->
                    </div>
                    <button id="station-return-btn" class="station-return-btn">Return to Space</button>
                </div>
                
                <div class="station-upgrades">
                    <div class="station-tabs">
                        <button class="station-tab active" data-tab="ships">Ships</button>
                        <button class="station-tab" data-tab="weapons">Weapons</button>
                        <button class="station-tab" data-tab="propulsion">Engines</button>
                        <button class="station-tab" data-tab="extractors">Extractors</button>
                        <button class="station-tab" data-tab="markets">Mineral Markets</button>
                    </div>
                    
                    <div id="tab-ships" class="station-tab-content active">
                        <!-- Ships content populated by JS -->
                    </div>
                    
                    <div id="tab-weapons" class="station-tab-content">
                        <!-- Weapons content populated by JS -->
                    </div>
                    
                    <div id="tab-propulsion" class="station-tab-content">
                        <!-- Propulsion content populated by JS -->
                    </div>
                    
                    <div id="tab-extractors" class="station-tab-content">
                        <!-- Extractors content populated by JS -->
                    </div>
                    
                    <div id="tab-markets" class="station-tab-content">
                        <!-- Mineral markets content populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="gameContainer">
        <div id="ui">
            <div id="loading">Loading...</div>
            <div id="debug"></div>
            <div id="tutorial-message"></div>
            <div id="danger-overlay"></div>
            <div id="ui-panel"></div>
            <img id="black-hud" src="assets/textures/black_hud.gif" alt="HUD">
            
            <!-- Distance Display -->
            <div id="distance-display">
                <div id="distance-value">100.0</div>
                <div id="distance-label">Clicks to Event Horizon</div>
            </div>
            
            <!-- HUD Bar Graphs -->
            <div id="hud-bars">
                <!-- Warp Bar -->
                <div class="bar-container">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="bar-warp"></div>
                    </div>
                    <div class="bar-value" id="value-warp">2.2</div>
                    <div class="bar-label">Warp</div>
                </div>
                
                <!-- Fuel Bar -->
                <div class="bar-container">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="bar-fuel"></div>
                    </div>
                    <div class="bar-value" id="value-fuel">100%</div>
                    <div class="bar-label">Fuel</div>
                </div>
                
                <!-- Cargo Bar -->
                <div class="bar-container">
                    <div class="bar-wrapper">
                        <div class="bar-fill" id="bar-iron"></div>
                    </div>
                    <div class="bar-value" id="value-iron">0.0t</div>
                    <div class="bar-label">CARGO</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Map for Three.js modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.180.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.180.0/examples/jsm/"
        }
    }
    </script>
    
    <!-- Initialize THREE globally BEFORE other scripts -->
    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        
        // Make THREE available globally
        window.THREE = THREE;
        
        // Make GLTFLoader available globally (can't attach to frozen THREE object)
        window.GLTFLoader = GLTFLoader;
        
        console.log('THREE loaded:', typeof THREE);
        console.log('GLTFLoader loaded:', typeof GLTFLoader);
        
        // Dispatch event when ready
        window.dispatchEvent(new Event('three-ready'));
    </script>
    
    <!-- Game Framework -->
    <script src="src/utils/AudioManager.js"></script>
    <script src="src/utils/AssetLoader.js"></script>
    <script src="src/utils/InputHandler.js"></script>
    <script src="src/utils/GameUtils.js"></script>
    <script src="src/utils/MenuManager.js"></script>
    <script src="src/core/GameObject.js"></script>
    <script src="src/objects/Player.js"></script>
    <script src="src/objects/Camera.js"></script>
    <script src="src/core/Game.js"></script>
    
    <!-- Game Entry Point -->
    <script>
        let game = null;
        let audioManager = null;
        let menuManager = null;
        
        async function initializeSystems() {
            try {
                // Wait for THREE to be ready
                await new Promise((resolve) => {
                    if (typeof THREE !== 'undefined' && typeof GLTFLoader !== 'undefined') {
                        resolve();
                    } else {
                        window.addEventListener('three-ready', resolve, { once: true });
                    }
                });
                
                console.log('THREE and GLTFLoader ready!');
                
                // Initialize audio manager
                audioManager = new AudioManager();
                audioManager.init();
                
                // Initialize game and start it for menu background
                game = new Game();
                await game.init(); // Initialize the black hole scene
                game.start(); // Start rendering for menu background
                
                // Initialize menu manager
                menuManager = new MenuManager();
                menuManager.init(game, audioManager);
                
                console.log('All systems initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize systems:', error);
                document.getElementById('loading').innerHTML = '<div style="color: red;">Failed to initialize game systems. Please refresh the page.</div>';
            }
        }

        // Initialize when page loads
        window.addEventListener('load', initializeSystems);
    </script>
</body>
</html>

